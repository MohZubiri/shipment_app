# نظام تتبع الشحنات - دليل التطوير

## نظرة عامة
تم تطوير النظام ليغطي الرحلة الكاملة للشحنات من بلد التصنيع حتى وصولها للمخزن.

## الميزات الجديدة

### 1. مراحل الشحن (Shipment Stages)
تم إضافة 9 مراحل رئيسية لتتبع الشحنة:
1. تصنيع (Manufacturing)
2. مغادرة المصنع (Factory Departure)
3. في الميناء المصدر (Source Port)
4. في الطريق (In Transit)
5. وصول الميناء (Port Arrival)
6. الجمارك (Customs Clearance)
7. إفراج (Released)
8. نقل للمخزن (Transport to Warehouse)
9. وصول المخزن (Warehouse Arrival)

### 2. حقول التتبع الجديدة في ShipmentTransaction

#### معلومات المنشأ:
- `origin_country` - بلد المنشأ
- `origin_port` - ميناء المصدر
- `factory_name` - اسم المصنع
- `factory_address` - عنوان المصنع

#### تواريخ المراحل:
- `manufacturing_date` - تاريخ التصنيع
- `factory_departure_date` - تاريخ مغادرة المصنع
- `port_departure_date` - تاريخ مغادرة الميناء
- `transit_arrival_date` - تاريخ الوصول للمنطقة
- `customs_clearance_date` - تاريخ إخلاء الجمارك
- `warehouse_arrival_date` - تاريخ الوصول للمخزن

#### معلومات النقل:
- `carrier` - الناقل
- `tracking_number` - رقم التتبع
- `vessel_name` - اسم السفينة
- `voyage_number` - رقم الرحلة

#### معلومات المخزن:
- `warehouse_location` - موقع المخزن
- `warehouse_section` - قسم المخزن
- `warehouse_zone` - منطقة المخزن

#### أخرى:
- `current_stage_id` - المرحلة الحالية
- `shipping_notes` - ملاحظات الشحن

### 3. سجل التتبع (Shipment Tracking)
جدول لتسجيل كل تحرك للشحنة مع:
- المرحلة
- الموقع الجغرافي (خطوط العرض والطول)
- الملاحظات
- المستخدم الذي أضاف السجل
- التاريخ والوقت

## خطوات التثبيت

### 1. تشغيل Migrations
```bash
php artisan migrate
```

### 2. تشغيل Seeder
```bash
php artisan db:seed --class=ShipmentStageSeeder
```

أو تشغيل جميع Seeders:
```bash
php artisan db:seed
```

## كيفية الاستخدام

### إضافة سجل تتبع
1. انتقل إلى صفحة الشحنة
2. اضغط على "تتبع الشحنة"
3. اضغط "إضافة سجل تتبع"
4. اختر المرحلة المناسبة
5. أدخل الموقع والملاحظات
6. احفظ

### عرض سجل التتبع
1. انتقل إلى صفحة الشحنة
2. اضغط على "تتبع الشحنة"
3. سترى سجل كامل لحركة الشحنة عبر المراحل المختلفة
4. سترى المرحلة الحالية والمراحل المكتملة والقادمة

## API المضاف

### ShipmentTransaction Model
```php
// الحصول على المرحلة الحالية
$shipment->currentStage;

// الحصول على سجلات التتبع
$shipment->trackingRecords;

// إضافة سجل تتبع جديد
$shipment->addTrackingRecord([
    'stage_id' => 1,
    'location' => 'ميناء جدة',
    'notes' => 'وصول البضائع للميناء',
    'created_by' => auth()->id(),
]);
```

## الصلاحيات المطلوبة

لإدارة التتبع، تأكد من أن المستخدم لديه الصلاحيات التالية:
- `view shipments` - لعرض سجل التتبع
- `manage shipments` - لإضافة سجلات التتبع

## المسارات الجديدة

- `GET /shipments/{shipment}/tracking` - عرض سجل التتبع
- `GET /shipments/{shipment}/tracking/create` - نموذج إضافة سجل تتبع
- `POST /shipments/{shipment}/tracking` - حفظ سجل تتبع

## الملاحظات

- عند إضافة سجل تتبع، يتم تحديث المرحلة الحالية للشحنة تلقائياً
- يمكن إضافة سجلات تتبع متعددة لنفس المرحلة إذا لزم الأمر
- نظام التتبع يعمل بشكل مستقل عن نظام الجمارك الحالي
- يمكن دمج التتبع مع نظام الإنذارات الموجود

## التطويرات المستقبلية المقترحة

1. إضافة إشعارات تلقائية عند الانتقال بين المراحل
2. دمج مع خرائط Google لعرض الموقع الجغرافي
3. إضافة تقارير متقدمة عن أوقات الانتقال بين المراحل
4. ربط مع أنظمة تتبع خارجية (مثل شركات الشحن)
5. إضافة واجهة API للتكامل مع أنظمة خارجية
